<!--
* 
* @ Name    :   DRL_convertLeadAccountSection
* @ Purpose :   This is the account section to fill details for existing ot create new account while lead conversion
* @ Author  :   Subhodeep Sarkar
*
*   Date            |  Developer Name               |  Version      |  Changes
* ======================================================================================================
*   03-11-2022      |  Subhodeep Sarkar           |  1.0          |  Initial Version
*
-->
<aura:component controller="DRL_ConvertLeadProspectController"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader"
                access='global'>
    
    
    <aura:attribute name="obj_Account" type="Account" default="{ 'sobjectType': 'Account'}" />
    <aura:attribute name="str_radioButtonValue" type="String"/>
    <aura:attribute name="str_accountId" type="String" />
    <aura:attribute name="existingAccount" type="String" default = ''/>
    <aura:attribute name='list_AccountFields' type='List' default="[]" />
    <aura:attribute name='list_accFieldsToRender' type='List' />
    <aura:attribute name="blnRadio2Available" type="Boolean" default = 'true'/>
    <aura:attribute name="blnRadio1Available" type="Boolean" default = 'true'/>
    <aura:attribute name = 'str_inputR1' type = 'String' default = '1'/>
    <aura:attribute name = 'str_inputR2' type = 'String' default = '2'/>
    <aura:attribute name = 'bln_allowInput1' type = 'Boolean' default = 'true'/>
    <aura:attribute name = 'bln_allowInput2' type = 'Boolean' default = 'false'/>
    <aura:attribute name="blnisParentProspectConverted" type="Boolean" default="false" />
    <aura:attribute name="isRadio1Checked" type="Boolean" default = 'true'/>
    <aura:attribute name="isRadio2Checked" type="Boolean" default = 'false'/>
    <aura:attribute name="objlead" type="Lead" default="{ 'sobjectType': 'Lead'}" />

    <aura:handler name="init" value='{!this}' action='{!c.doInit}' />
    
    <!--Start-->
        <div class="accountSection slds-border_bottom">            
            <span class="header slds-theme_alt-inverse">
                <span class="headerLabel">Account</span>
            </span>
            <div class="accountFormSection">                
                <div class="accountFormSectionContainer">
                    <lightning:input type="radio" onchange="{!c.handleRadioChange}" label="Choose Existing"
                                     class="accountRadioButton" name="options" value="{!v.str_inputR2}" checked="{!v.isRadio2Checked}" disabled="{!!v.blnRadio2Available}"/>
                    <lightning:recordEditForm objectApiName="Contact">
                        <label for="nameField" class="slds-form-element__label slds-no-flex">
                            <span style="color:#c64541;">*&nbsp;</span>Account Search</label>
                        <aura:if isTrue = '{!v.bln_allowInput2}'>
                            <lightning:inputField aura:id="nameField" fieldName="AccountId" 
                                                  variant="label-hidden" disabled='false' value = '{!v.existingAccount}'
                                                  messageWhenBadInput="Please choose an existing account or create a new one."
                                                  onchange="{!c.handleLookup}" />
                            <aura:set attribute = 'else'>
                                <aura:if isTrue="{!v.blnisParentProspectConverted}">
                                    <div class="container" style = "padding-left:20px">
                                        <span class="slds-pill slds-pill_link accountPill">
                                            <span class="slds-pill__icon_container">
                                                <lightning:icon iconName="standard:account" alternativeText="Account" title="Account" />
                                            </span>
                                            <a href="{!join('','/',v.obj_Account.Id)}" target="_self" class="slds-pill__action" title="Full pill label verbiage mirrored here">
                                              <span class="slds-pill__label">{!v.obj_Account.Name}</span>
                                            </a>
                                          </span>
                                    </div>
                                    <aura:set attribute = 'else'>
                                        <lightning:inputField aura:id="nameField" fieldName="AccountId" 
                                                      variant="label-hidden" disabled='true' value = '{!v.existingAccount}'
                                                      messageWhenBadInput="Please choose an existing account or create a new one."
                                                      onchange="{!c.handleLookup}" />
                                    </aura:set>
                                </aura:if>
                            </aura:set>
                        </aura:if>                        
                    </lightning:recordEditForm>
                </div>
                <div class="accountFormSectionContainer">
                    <lightning:input type="radio" onchange="{! c.handleRadioChange }" label="Create New"
                                     class="accountRadioButton" name="options" value="{!v.str_inputR1}" checked="{!v.isRadio1Checked}" disabled="{!!v.blnRadio1Available}" />
                    <lightning:recordEditForm aura:id="accountForm" objectApiName="Account">
                        <lightning:messages />
                        <div class="slds-form formContainer">
                            <div class="slds-col slds-size_1-of-1">
                                <aura:iteration items="{!v.list_accFieldsToRender}" var="field" indexVar="name">
                                    <aura:if isTrue = '{!v.bln_allowInput1}'>
                                        <aura:if isTrue = '{!field.required}'>
                                            <lightning:inputField fieldName="{!field.name}" value="{!field.value}" aura:id ="{!field.name}"
                                                              required="{!field.required}" disabled='false'
                                                              class="slds-form-element" onchange="{!c.handleValueChange}" />
                                            <aura:set attribute = 'else'>
                                                <lightning:inputField fieldName="{!field.name}" value="{!field.value}" aura:id ="{!field.name}"
                                                              disabled='false'
                                                              class="slds-form-element" onchange="{!c.handleValueChange}" />
                                            </aura:set>
                                        </aura:if>
                                        
                                        <aura:set attribute = 'else'>
                                            <lightning:inputField fieldName="{!field.name}" value="{!field.value}" aura:id ="{!field.name}"
                                                                  required="{!field.required}" disabled='true'
                                                                  class="slds-form-element" onchange="{!c.handleValueChange}" />
                                        </aura:set>
                                    </aura:if>
                                </aura:iteration>
                            </div>
                        </div>
                    </lightning:recordEditForm>
                </div>
            </div>
        </div>
</aura:component>